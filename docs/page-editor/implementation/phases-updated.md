# 実装フェーズ（更新版）

## 概要

page-editorの実装を6つのフェーズに分けて段階的に進めます。各フェーズは優先度の高い機能から順次実装していきます。

## Phase 1: 基盤構築

### 目標
- プロジェクト構造の整備
- エディタブルテキストブロックシステムの実装
- 基本的なブロックタイプの実装

### 実装内容

#### 1. プロジェクト構造の整備
```bash
page-editor/
├── app/
│   ├── components/
│   │   ├── editor/
│   │   ├── blocks/
│   │   ├── panels/
│   │   └── layout/
│   ├── lib/
│   │   ├── api/
│   │   ├── markdown/
│   │   ├── blocks/
│   │   └── utils/
│   └── types/
├── public/
└── docs/
```

#### 2. 型定義の作成
- `types/blocks.ts`: ブロックシステムの型定義
- `types/editor.ts`: エディター状態の型定義
- `types/inline.ts`: インライン機能の型定義

#### 3. 基本レイアウトの実装
- `EditorLayout.tsx`: メインレイアウト
- `Sidebar.tsx`: サイドバーコンポーネント
- `BlockEditor.tsx`: エディタブルテキストブロックエディター

#### 4. Markdownパーサーの実装
- `lib/markdown/parser.ts`: remarkベースのパーサー
- `lib/markdown/block-parser.ts`: ブロックタグ解析
- `lib/markdown/renderer.ts`: HTMLレンダラー

#### 5. 基本ブロックの実装
- `TextBlock.tsx`: テキストブロック
- `HeadingBlock.tsx`: 見出しブロック
- `ListBlock.tsx`: リストブロック
- `QuoteBlock.tsx`: 引用ブロック

### 成果物
- [ ] プロジェクト構造の完成
- [ ] エディタブルテキストブロックエディターの動作
- [ ] Markdownの読み込み・表示
- [ ] 基本ブロックのレンダリング

### 技術的課題
- エディタブルテキストのフォーカス管理
- Markdownパーサーの拡張
- ブロックシステムの基盤設計

## Phase 2: メディアブロック

### 目標
- メディアファイルの処理機能（10MB以内）
- ファイルアップロード機能
- メディアブロックの実装

### 実装内容

#### 1. メディア処理システム
- `lib/utils/file-upload.ts`: ファイルアップロード処理
- `lib/utils/validation.ts`: ファイル検証（10MB以内）
- `lib/utils/sanitize.ts`: セキュリティ処理

#### 2. ファイルアップロード機能
- `MediaUploadForm.tsx`: ファイルアップロードフォーム
- ドラッグ&ドロップ機能
- Base64エンコード処理

#### 3. メディアブロックの実装
- `ImageBlock.tsx`: 画像ブロック
- `VideoBlock.tsx`: 動画ブロック
- `AudioBlock.tsx`: 音声ブロック
- `FileBlock.tsx`: ファイルブロック
- `WebBookmarkBlock.tsx`: Webブックマークブロック

#### 4. メディア管理パネル
- `MediaManager.tsx`: メディア管理パネル
- メディア一覧表示
- メディアの削除機能

### 成果物
- [ ] メディアファイルの処理機能
- [ ] ファイルアップロード機能
- [ ] メディアブロックの実装
- [ ] メディア管理パネル

### 技術的課題
- ファイルサイズ制限（10MB以内）
- Base64エンコードの最適化
- メディアプレビューの実装
- セキュリティ対策

## Phase 3: インライン機能

### 目標
- インライン要素の解析機能
- エディター機能の拡張
- インラインコンポーネントの実装

### 実装内容

#### 1. インラインパーサーの実装
- `lib/markdown/inline-parser.ts`: インライン要素解析
- `@username` メンション機能
- `[[page]]` ページリンク機能
- `@date` 日付・リマインダー機能
- `:emoji:` 絵文字機能

#### 2. エディター機能の拡張
- `InlineToolbar.tsx`: インラインツールバー
- ショートカットキーの実装
- オートコンプリート機能

#### 3. インラインコンポーネントの実装
- `MentionComponent.tsx`: メンション表示
- `PageLinkComponent.tsx`: ページリンク表示
- `DateComponent.tsx`: 日付表示
- `EmojiComponent.tsx`: 絵文字表示

### 成果物
- [ ] インライン要素の解析機能
- [ ] エディター機能の拡張
- [ ] インラインコンポーネントの実装

### 技術的課題
- インライン要素の解析精度
- エディター機能の統合
- パフォーマンス最適化

## Phase 4: 応用ブロック

### 目標
- 高度なブロックタイプの実装
- プレビュー機能の拡張
- コールアウトブロックの実装

### 実装内容

#### 1. 高度なブロックの実装
- `TableOfContentsBlock.tsx`: 目次ブロック
- `ToggleBlock.tsx`: トグルブロック
- `MathBlock.tsx`: 数式ブロック
- `CodeBlock.tsx`: コードブロック

#### 2. プレビュー機能の拡張
- リアルタイムプレビューの最適化
- ブロック単位のレンダリング
- 静的サイト生成機能

#### 3. コールアウトブロックの実装
- `CalloutBlock.tsx`: コールアウトブロック
- 複数のコールアウトタイプ
- カスタマイズ可能なスタイル

### 成果物
- [ ] 高度なブロックタイプの実装
- [ ] プレビュー機能の拡張
- [ ] コールアウトブロックの実装

### 技術的課題
- 複雑なブロックの実装
- プレビュー機能の最適化
- スタイルのカスタマイズ

## Phase 5: データベースブロック

### 目標
- テーブル機能の実装
- ビュー機能の実装
- データ管理機能の実装

### 実装内容

#### 1. テーブル機能の実装
- `TableBlock.tsx`: テーブルブロック
- セルの編集機能
- 行・列の追加・削除機能

#### 2. ビュー機能の実装
- `BoardBlock.tsx`: カンバンボード
- `CalendarBlock.tsx`: カレンダー
- `GalleryBlock.tsx`: ギャラリー

#### 3. データ管理機能の実装
- データの永続化
- データの検索・フィルタリング
- データのエクスポート・インポート

### 成果物
- [ ] テーブル機能の実装
- [ ] ビュー機能の実装
- [ ] データ管理機能の実装

### 技術的課題
- 複雑なデータ構造の管理
- ビュー機能の実装
- データの永続化

## Phase 6: 埋め込みブロック

### 目標
- 外部サービスの統合
- セキュリティ機能の強化
- 最終調整

### 実装内容

#### 1. 外部サービスの統合
- `YouTubeEmbed.tsx`: YouTube埋め込み
- `GoogleMapEmbed.tsx`: Googleマップ埋め込み
- `TwitterEmbed.tsx`: Twitter埋め込み
- `CustomEmbed.tsx`: カスタムHTML埋め込み

#### 2. セキュリティ機能の強化
- HTMLサニタイゼーション
- ファイル検証の強化
- アクセシビリティ対応

#### 3. 最終調整
- パフォーマンス最適化
- エラーハンドリングの改善

### 成果物
- [ ] 外部サービスの統合
- [ ] セキュリティ機能の強化
- [ ] 最終調整

### 技術的課題
- 外部サービスの統合
- セキュリティ機能の実装
- 最終調整
